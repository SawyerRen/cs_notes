# 第二章：数据模型与查询语言

## 关系模型和文档模型

### 一对多的关系表示

类似一个人可以有多份工作，或者不同的教育阶段和任意数量的联系信息，用户和一些项目之间存在一对多的关系，可以用多种方式表示：

* 传统SQL模型中，最常见的是将职位、教育和联系信息放在单独的表中，在User表中用外键引用
* 一些SQL标准增加了对结构化数据和XML数据的支持，可以将这类数据存在单行中并支持查询和索引，比如MySQL, PostgreSQL等等
* 把职业，教育和联系信息编码为JSON或者XML文档，保存在数据库的文本列中，让应用程序来解析其结构和内容

对于一个这样的关系，JSON是非常合适的，很多面向文档的数据库支持JSON，如MongoDB等等。

JSON表示有更多的局部性，不需要像关系模型那样从多个表中连接并查询。

### 关系型数据库vs文档数据库

#### 哪种数据模型更有助于简化代码？

* 如果程序中的数据具有类似文档的结构，文档模型可能是更好的
* 文档模型有一些局限性，如不能直接引用文档中的嵌套项目
* 文档数据库不支持连接，如果存在多对多的关系，那么文档数据库会让代码更复杂
* 对于高度关联的数据，文档数据库的表现很差

#### 文档模型的模式灵活性

大多数JSON都不会强制数据的格式，这意味着可以将任意的键和值添加到文档中，并且当读取时，客户端无法保证文档可能包含的字段。

这被成为schema-on-read，只有在代码读取的时候才会知道数据的结构，与之对应的是关系型数据库的schema-on-write。

在我们想要改变数据格式时，比如将用户的名字改成分别存储名字和姓氏。在文档数据库中，只需要新添加对应的字段即可。但是在关系型数据库中，我们需要进行迁移操作，在MySQL中执行`Alter TABLE`时，会复制整个表，会导致几分钟甚至几个小时的停机。而`UPDATE`操作也会很慢。

有的时候，集合中的项目的结构是不同的，文档数据库会更有优势。

#### 查询的数据局部性

如果程序需要访问整个文档，那么文档数据库的存储局部性会有优势，但是如果只访问一小部分，文档数据库仍会加载整个文档，这是很浪费的。

#### 文档和关系数据库的融合

大多数数据库（MySQL除外）都已经支持XML。PostgreSQL，MySQL以及IBM DB2也支持Json文档。

## 图数据模型

对于多对多关系很常见的数据，图数据模型更加自然，多用于社交图谱、网络图谱、公路或铁路网络。

图包含两种对象：顶点（节点）和边。

图数据模型有很大的灵活性，任何顶点都可以连接到其他任何顶点，对于任何节点，都可以高效找出入边和出边
